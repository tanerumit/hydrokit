CONTEXT
You are modifying an R package repo (weathergenr). Work in-place from the package root.

GOAL
Improve correctness, readability, maintainability, numerical stability, and testability with minimal, surgical changes.

HARD CONSTRAINTS (NON-NEGOTIABLE)
- Keep all files UTF-8.
- Do not change exported function names, arguments, defaults, or return structures unless explicitly instructed.
- Preserve numerical outputs within tolerance 1e-12 unless methodology changes are explicitly requested.
- Do not add new external dependencies. Do not require Suggests packages at runtime. If unavoidable, guard with requireNamespace() and justify.
- Do not introduce purrr or functional-programming rewrites; use explicit for loops and base R idioms.
- Preserve deterministic behavior; control randomness/seeds explicitly where relevant.
- Minimal diff: modify only what is necessary; no sweeping refactors or style-only reformatting. Do not rename/move files unless instructed.
- Do not silently change user-visible outputs, warnings, or errors; document any necessary changes in the final summary.
- Do not silently drop columns/fields/rows.

NON-INTERACTIVE EXECUTION (MANDATORY)
- Execute end-to-end in a single pass without questions or confirmations.
- Do not provide interim progress updates.
- If ambiguous, apply the smallest conservative assumption consistent with package conventions and document it at the end.
- Update tests when behavior changes or coverage gaps exist.
- Run tests at the end; stop only when requested changes are implemented and tests pass (or only external/irreproducible failures remain).

STYLE & STRUCTURE
- Prefer guard clauses/early returns; explicit type/length checks (use existing helpers where available).
- Avoid deep nesting; extract helpers only when it materially improves readability.
- Avoid asymptotic regressions; preallocate; avoid O(nÂ²) patterns on time-series data.

DOCUMENTATION
- Exported functions: roxygen must match behavior exactly (@description one paragraph; @details brief assumptions/edge cases; params types/units/NA; return exact structure; examples minimal/fast; use \dontrun{} for expensive).
- Internal functions: minimal docs; use @keywords internal only if needed. Do not invent behavior.

TESTS
- Tests must be deterministic; no network, large fixtures, or uncontrolled randomness.
- Cover input validation, NA handling, empty/constant series, methodological consistency, return structure.
- Group tests by function/group; at top of each test file list functions under test with relative paths.

FINAL OUTPUT (ONCE COMPLETE)
- Bullet summary: what changed, why, risks/assumptions.
- List of files changed.
- Explicit design choices.
- Report remaining issues only if external/irreproducible.


TASK
[One paragraph describing what to implement and what must not change.]

SCOPE (FILES)
[List specific files/paths allowed to change.]

IMPLEMENTATION REQUIREMENTS
- [Concrete steps, in order]
- [Any invariants or numerical tolerances]
- [What to keep identical]
- [What new tests to add/update]
- [Any test commands to run]

DONE CRITERIA
- [Exact pass/fail conditions]

