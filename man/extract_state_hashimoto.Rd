% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wres_metrics.R
\name{extract_state_hashimoto}
\alias{extract_state_hashimoto}
\title{Extract Hashimoto binary state, deficit, events, and transitions}
\usage{
extract_state_hashimoto(
  obs_threshold,
  sim_supply,
  na_action = c("omit", "fail"),
  include_events = TRUE,
  include_transitions = TRUE
)
}
\arguments{
\item{obs_threshold}{Numeric vector. Threshold per timestep (same units as supply).}

\item{sim_supply}{Numeric vector. Supply per timestep.}

\item{na_action}{Character scalar: "omit" (drop non-finite pairs) or "fail" (error).}

\item{include_events}{Logical. If TRUE, compute failure event diagnostics.}

\item{include_transitions}{Logical. If TRUE, compute transition-aligned vectors.}
}
\value{
A list with elements:
\itemize{
\item \code{obs_threshold} numeric vector (cleaned)
\item \code{sim_supply} numeric vector (cleaned)
\item \code{sim_deficit} numeric vector (cleaned; >= 0)
\item \code{is_success} logical vector
\item \code{is_fail} logical vector
\item \code{n_steps} integer, length of cleaned series
\item \code{n_dropped} integer, number of dropped timesteps due to NA handling
}

If \code{include_events = TRUE}, also:
\itemize{
\item \code{n_fail_events} integer
\item \code{fail_event_lengths} integer vector (run lengths)
\item \code{fail_event_starts} integer vector (start indices, 1-based, cleaned series)
\item \code{fail_event_ends} integer vector (end indices, 1-based, cleaned series)
}

If \code{include_transitions = TRUE}, also:
\itemize{
\item \code{n_transitions} integer (n_steps - 1 if n_steps >= 2 else 0)
\item \code{is_fail_t} logical vector length n_transitions
\item \code{is_success_tp1} logical vector length n_transitions
}
}
\description{
Creates a standardized representation of Hashimoto-style system state from
threshold and supply series, suitable for computing reliability, resilience,
vulnerability, and event/run diagnostics.
}
\details{
Success is defined as \code{sim_supply >= obs_threshold} and failure as
\code{sim_supply < obs_threshold}. Deficit magnitude is defined as
\code{max(obs_threshold - sim_supply, 0)} (zero in success).

NA handling:
\itemize{
\item \code{na_action = "omit"} drops timesteps where either input is non-finite.
\item \code{na_action = "fail"} errors if any non-finite values occur.
}

Event/run logic:
Failure events are contiguous runs of failure timesteps (via \code{rle()}).

Transition logic:
Transitions are computed on the \strong{cleaned} series using timestep pairs
\code{t -> t+1}. \code{is_fail_t} and \code{is_success_tp1} are aligned to transitions.
}
\examples{
obs_threshold <- rep(10, 6)
sim_supply <- c(12, 8, 7, 11, 9, 10)
st <- extract_state_hashimoto(obs_threshold, sim_supply)
mean(st$is_success)  # reliability
}
