% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/eflow_erfa.R
\name{evaluate_erfa_class}
\alias{evaluate_erfa_class}
\title{Calculate Environmental Flow Risk Assessment (ERFA) Class}
\usage{
evaluate_erfa_class(
  baseline_tbl,
  scenario_tbl,
  sensi_threshold = 30,
  stat = "med",
  metric_set = "erfa70"
)
}
\arguments{
\item{baseline_tbl}{Summary table from \code{calculate_hydro_metrics()} representing
baseline conditions.}

\item{scenario_tbl}{Summary table from \code{calculate_hydro_metrics()} representing
scenario conditions.}

\item{sensi_threshold}{Numeric scalar > 0. Absolute percent-change threshold used
to flag metrics as outside the sensitivity range (default 30).}

\item{stat}{Character scalar. Summary statistic to compare (default "med").}

\item{metric_set}{Character scalar. Registered metric set to evaluate (default
"erfa70").}
}
\value{
A list with:
\itemize{
\item \code{detail}: metric-level comparison table with baseline/scenario values,
percent change, and a logical \code{outside_range} flag.
\item \code{summary}: group-level and overall ERFA classification table with counts,
percent outside, and risk class/label.
}
}
\description{
Compares a registry-defined subset of hydrological metrics (default: ERFA70)
between baseline and scenario summaries, counts metrics outside a sensitivity
threshold by group, and assigns ERFA risk classes.
}
\details{
Inputs should be summary tables returned by \code{calculate_hydro_metrics()} and
must contain \code{metric_key}, \code{group}, \code{stat}, and \code{value}. If a
\code{site} column is present in either table, comparisons are performed per site.
Percent change is computed as \code{100 * (scenario - baseline) / baseline}; when
the baseline value is non-finite or zero, percent change is set to NA and the
metric is not counted as outside the threshold. Only metrics present in both
tables are compared (inner join).
}
\examples{
date <- seq.Date(as.Date("2001-01-01"), as.Date("2002-12-31"), by = "day")
Q <- 2 + sin(seq_along(date) * 2 * pi / 365)
baseline <- calculate_hydro_metrics(Q, date)
scenario <- calculate_hydro_metrics(Q * 1.1, date)
erfa <- evaluate_erfa_class(baseline, scenario, sensi_threshold = 30, stat = "med")
erfa$summary
}
