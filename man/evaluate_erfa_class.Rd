% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/eflow_erfa.R
\name{evaluate_erfa_class}
\alias{evaluate_erfa_class}
\title{Calculate Environmental Flow Risk Assessment (ERFA) Class}
\usage{
evaluate_erfa_class(
  baseline_tbl,
  scenario_tbl,
  sensi_threshold = 30,
  metric_set = "erfa70",
  group_cols = NULL,
  scenario_cols = NULL
)
}
\arguments{
\item{baseline_tbl}{\code{data.frame}/tibble with at minimum:
\itemize{
\item \code{metric_id} (integer-like)
\item \code{value} (numeric)
If \code{group_cols} is not \code{NULL}, those columns must also be present.
}}

\item{scenario_tbl}{Same requirements as \code{baseline_tbl}.}

\item{sensi_threshold}{Numeric sensitivity threshold(s) in \strong{percent} for exceedance counting.
Either a single numeric scalar (recycled to all ERFA groups), or a named numeric vector
with names \code{HF}, \code{MF}, \code{LF}, \code{RFC}, and \code{IF}. Values must be finite and \verb{>= 0}.}

\item{metric_set}{Character scalar metric-set name. Currently supports \code{"erfa70"}
which resolves the full expanded mapping via \code{.hydro_registry_erfa70_expanded()}.}

\item{group_cols}{Character vector of grouping columns to evaluate ERFA per level/combination.
Default \code{NULL} computes a single ERFA result for the entire tables. Examples:
\itemize{
\item \code{group_cols = "site"}: compute per site
\item \code{group_cols = c("site", "scenario")}: compute per site√óscenario combination
}}
}
\value{
A list with:
\itemize{
\item \code{detail}: per-metric comparisons including registry metadata and computed fields.
\item \code{summary}: per-group and overall counts and ERFA risk class/label, per grouping combination.
}
}
\description{
Compare a registry-defined ERFA metric set between baseline and scenario summaries,
count threshold exceedances by ERFA group, and assign ERFA risk classes.
}
\details{
This function compares baseline vs scenario \strong{values indexed by \code{metric_id}}.
All ERFA metadata (group assignment, base \code{metric_key}, summary statistic \code{stat},
and legacy metric name \code{metric}) are taken from the metric-set registry.

If \code{group_cols} is provided, ERFA is computed separately for each unique
combination of grouping column values found in the inputs. Technically this is
implemented by joining baseline and scenario on \code{metric_id} plus \code{group_cols},
then summarising within each group-combination.
}
